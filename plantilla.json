{

  "variables": {
    "oas-repo-name": "{{env `OAS_REPO`}}",
    "oas-vpc-id": "{{env `OAS_VPC`}}",
    "oas-subnet-id": "{{env `OAS_SUBNET`}}",
    "external-ref": "{{env `OAS_EXTERNAL_REF`}}",
    "expiration-timestamp": "{{env `OAS_EXPIRATION_TIMESTAMP`}}",
    "packer-expiration-timestamp": "{{env `PACKER_EXPIRATION_TIMESTAMP`}}"
  },

  "builders": [
    {
      "type": "amazon-ebs",
      "ssh_pty": "true",
      "ami_name": "oas-condor-estudiantes {{user `external-ref`}}",
      "tags": {
        "ami-name": "oas-condor-estudiantes",
        "external-ref": "{{user `external-ref`}}",
        "promoted": "no",
        "expiration-timestamp": "{{user `expiration-timestamp`}}"
      },
      "run_tags": {
        "ami-name": "oas-condor-estudiantes",
        "external-ref": "{{user `external-ref`}}",
        "promoted": "no",
        "expiration-timestamp": "{{user `packer-expiration-timestamp`}}"
      },
      "instance_type": "t2.micro",
      "region": "us-east-1",
      "source_ami": "ami-6d1c2007",
      "ssh_username": "centos",
      "iam_instance_profile": "oas-ami-builder-role",
      "launch_block_device_mappings": [
        {
          "volume_type": "gp2",
          "device_name": "/dev/sda1",
          "delete_on_termination": true,
          "volume_size": 30
        }
      ],
      "vpc_id": "{{user `oas-vpc-id`}}",
      "subnet_id": "{{user `oas-subnet-id`}}"
    }
  ],

  "provisioners": [
    {
      "type": "shell",
      "script": "install_aws.sh"
    },
    {
      "type": "file",
      "source": "oas_scripts",
      "destination": "/tmp"
    },
    {
      "type": "shell",
      "script": "instalar-condor-estudiantes.sh",
      "environment_vars": [
        "oas_repo={{user `oas-repo-name`}}"
      ]
    }
  ]

}
